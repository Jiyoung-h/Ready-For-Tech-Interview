# Nginx를 이용한 무중단 배포
- **배포** : 새로 개발된 코드를 패키징하여 서버에 새로운 버전의 애플리케이션을 실행하도록 하는 것
- 이전버전을 종료시키고 새로운 버전의 애플리케이션을 실행하면 요청을 받을 준비가 될 때까지 서비스가 중단된다 → **다운타임(downtime)**
- 이전버전을 종료시키는 이유 ? 
	- 이전버전의 애플리케이션과 새로운 버전의 애플리케이션은 같은 포트를 사용하기 때문에 하나의 서버에서 하나의 포트를 동시에 서로 다른 애플리케이션이 사용하는 것은 불가능하기 때문

- 애플리케이션 서버를 2개로 늘려 하나로 배포하는 동안 다른 하나는 서비스를 제공하는 방법
	- 문제
		1. 사용자가 두 서버의 아이피를 알아야하고
		2. 어떤것이 배포중인 서버인지 알 수 없다
	- 해법 : 그 사이에 중개해 줄 **리버스 프록시**가 필요하다
		- 프록시 : 대리자 → 클라이언트를 숨겨주는 역할
		- 리버스 프록시 : 서버를 숨겨주는 역할
			-  Nginx : 하나의 서버에서 받아야 할 요청을 여러 개로 분산시키는 역할 → 부하분산 (로드밸런싱)

- 배포 방식
1. 롤링 배포 : 서버에 배포 중이라 요청이 실패하면 다른 정상 서버로 다시 요청
2. 블루그린 배포
3. 카나리 배포

***Q ) 트래픽이 많아져도 Nginx로 충분한가요?***
<br>
**A )** X , 스케일아웃으로 애플리케이션 서버가 많아져도 어차피 트래픽은 Nginx를 거쳐가고 Nginx 서버가 처리할 수 있는 요청도 한계가 있다.
- 해결
1. Nginx가 실행되는 서버 스케일업 
2. Nginx와 같은 SW가 아니라 HW 네트워크 장치로 로드 밸런싱
→ L4, L7 스위치
3. DNS 리다이렉션

***Q ) 롤링으로 배포하다가 배포에 실패하면 어떡해요?***
<Br>
**A )** 새로운 버전을 이전 버전으로 롤백시키고 원인 찾는다.
- *배포성공여부체크 ?* 제3의 서비스 이용
- *수동롤백 VS 자동롤백 ?* 사람이 우선 수동으로 롤백하고 배포가 잦은 조직이면 자동 롤백
