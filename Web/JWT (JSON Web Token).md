# JWT (JSON Web Token)

JWT는 웹표준(RFC 7519)으로써 두 개체에서 JSON 객체를 사용하여 가볍고 자가수용적인 방식으로 정보를 안전성 있게 전달해준다.

## 구성요소

JWT는 ```.```을 구분자로 3가지의 문자열로 구성되어 있다.
1. 헤더 (header)
2. 내용 (payload)
3. 서명 (signature)

### 헤더 (header)

헤더는 ```typ```와 ```alg``` 두가지의 정보를 지니고 있다.
- typ : 토큰의 타입 (JWT)
- alg : 해싱 알고리즘,

### 정보 (payload)

Payload 부분에는 토큰을 담을 정보가 들어있다. 정보의 한 조각을 클레임(claim)이라고 하고, 이는 name/value 한 쌍으로 이루어져 있다. 토큰에는 여러개의 클레임들을 넣을 수 있지만 너무 많아질 경우 토큰의 길이가 길어질 수 있다.

- 클레임의 종류

1. **등록된(registered) 클레임** : 서비스에서 필요한 정보들이 아닌 토큰에 대한 정보들을 담기 위하여 이름이 이미 정해진 클레임. 등록된 클레임의 사용은 모두 선택적
- ```iss``` : 토큰 발급자 (issuer)
- ```sub``` : 토큰 제목 (subject)
- ```aud``` : 토큰 대상자 (audience)
- ```exp``` : 토큰의 만료시간(expiration), 시간은 NumericDate 형식으로 되어있어야 하며 언제나 현재 시간보다 이후로 설정되어 있어야 함
- ```nbf``` : Not Before을 의미하며, 토큰의 활성 날짜와 비슷한 개념. NumericDate 형식으로 날짜 지정. 날짜가 지나기 전까지는 토큰이 처리되지 않음
- ```iat``` : 토큰이 발급된 시간(issued at), 이 값을 사용하여 토큰의 age 판단
- ```jti``` : JWT의 고유 식별자. 중복적인 처리를 방지하기 위해 사용. 일회용 토큰에 사용


2. **공개(public) 클레임** : 충돌이 방지된(collision-resistant) 이름. 충돌을 방지하기 위해 클레임 이름을 URI형식으로 짓는다

3. **비공개(private) 클레임** : 등록된, 공개된 클레임도 아님. 양 측간에(클라이언트-서버) 합의하에 사용되는 클레임 이름들. 이름 중복 충돌을 유의해야 한다

### 서명(signature)

서명은 헤더의 인코딩값과 정보의 인코딩값을 합친 후 주어진 비밀키로 해쉬를 하여 생성. 이렇게 만든 해쉬를 ```base64``` 형태로 나타냄

## 로그인 인증시 JWT 사용

- 만약 유효기간이 짧은 토큰을 발급시, 사용자 입장에서 자주 로그인을 해야하기 때문에 번거럽고, 유효기간이 긴 토큰을 발급시, 제3자에게 토큰을 탈취당할 경우 보안에 취약하다는 약점
- 그 점들을 보완하기 위해 ```Refresh Token``` 사용
- ```Refresh Token```은 ```Access Token```과 똑같은 JWT
- ```Access Token```의 유효기간이 만료되었을 때, ```Refresh Token```이 새로 발급해주는 열쇠
- 이 방법또한 ```Access Token```이 탈취당한다해도 정보가 유출이 되는걸 막을 수 없지만, 더 짧은 유효기간때문에 탈취되는 가능성이 적다는 점을 이용
